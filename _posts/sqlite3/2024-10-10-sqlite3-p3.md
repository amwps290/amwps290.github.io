---
title: SQLite3 源码分析-数据表的创建
author: amwps290
date: 2024-10-10 15:43:28
categories: [SQLITE,源码分析]
mermaid: true
tags: [sqlite]
---

## 前记

在这一篇中我们将来看一下数据表的创建，这里我们暂不说明底层数据的存储。只说明 VDBE 相关内容。这里我们列出了 `CREATE TABLE test5(id int)` 的 VDBE 执行码。

```
addr  opcode         p1    p2    p3    p4             p5  comment
----  -------------  ----  ----  ----  -------------  --  -------------
0     Init           0     30    0                    0   Start at 30
1     ReadCookie     0     3     2                    0
2     If             3     5     0                    0
3     SetCookie      0     2     4                    0
4     SetCookie      0     5     1                    0
5     CreateBtree    0     2     1                    0   r[2]=root iDb=0 flags=1
6     OpenWrite      0     1     0     5              0   root=1 iDb=0
7     NewRowid       0     1     0                    0   r[1]=rowid
8     Blob           6     3     0                   0   r[3]= (len=6)
9     Insert         0     3     1                    8   intkey=r[1] data=r[3]
10    Close          0     0     0                    0
11    Close          0     0     0                    0
12    Null           0     4     5                    0   r[4..5]=NULL
13    Noop           2     0     4                    0
14    OpenWrite      1     1     0     5              0   root=1 iDb=0; sqlite_master
15    Explain        15    0     0     SEARCH main.sqlite_master USING INTEGER PRIMARY KEY (rowid=?)  0
16    ReleaseReg     11    1     0                    0   release r[11] mask 0
17    SeekRowid      1     19    1                    0   intkey=r[1]
18    Rowid          1     5     0                    0   r[5]= rowid of 1
19    IsNull         5     27    0                    0   if r[5]==NULL goto 27
20    String8        0     6     0     table          0   r[6]='table'
21    String8        0     7     0     test5          0   r[7]='test5'
22    String8        0     8     0     test5          0   r[8]='test5'
23    SCopy          2     9     0                    0   r[9]=r[2]
24    String8        0     10    0     CREATE TABLE test5(id int)  0   r[10]='CREATE TABLE test5(id int)'
25    MakeRecord     6     5     4     BBBDB          0   r[4]=mkrec(r[6..10])
26    Insert         1     4     5                    0   intkey=r[5] data=r[4]
27    SetCookie      0     1     5                    0
28    ParseSchema    0     0     0     tbl_name='test5' AND type!='trigger'  0
29    Halt           0     0     0                    0
30    Transaction    0     1     4     0              1   usesStmtJournal=1
31    TableLock      0     1     1     sqlite_master  0   iDb=0 root=1 write=1
32    Goto           0     1     0                    0
```

## 代码解析




## 后记
源码分析真的有点难,还是有很多不理解的地方.😄

